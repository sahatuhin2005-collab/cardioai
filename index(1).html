<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CardioAI â€” Intelligent Cardiac Medical Assistant</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=DM+Mono:wght@300;400;500&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet" />

  <style>
    /* â”€â”€ Reset & Variables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:        #04060a;
      --bg2:       #080d14;
      --surface:   #0c1420;
      --surface2:  #111d2e;
      --border:    rgba(255,255,255,0.07);
      --border2:   rgba(255,255,255,0.12);
      --red:       #e8294a;
      --red-dim:   #a01d33;
      --red-glow:  rgba(232,41,74,0.18);
      --gold:      #c9a84c;
      --gold-dim:  rgba(201,168,76,0.15);
      --text:      #eef0f4;
      --text2:     #8fa0b8;
      --text3:     #506070;
      --mono:      'DM Mono', monospace;
      --serif:     'Cormorant Garamond', serif;
      --sans:      'Syne', sans-serif;
      --radius:    12px;
      --radius-lg: 20px;
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: var(--sans);
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* â”€â”€ Grain overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    body::before {
      content: '';
      position: fixed; inset: 0; z-index: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
      background-repeat: repeat;
      background-size: 200px;
      pointer-events: none;
      opacity: 0.5;
    }

    /* â”€â”€ ECG line animation at very top â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .ecg-header {
      position: fixed; top: 0; left: 0; right: 0; z-index: 100;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--red), transparent);
      animation: ecg-slide 3s linear infinite;
      box-shadow: 0 0 12px var(--red), 0 0 30px var(--red-glow);
    }
    @keyframes ecg-slide {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* â”€â”€ Nav â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    nav {
      position: sticky; top: 0; z-index: 90;
      display: flex; align-items: center; justify-content: space-between;
      padding: 18px 48px;
      background: rgba(4, 6, 10, 0.9);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
    }

    .nav-logo {
      display: flex; align-items: center; gap: 12px;
    }

    .logo-icon {
      width: 36px; height: 36px;
      display: flex; align-items: center; justify-content: center;
      position: relative;
    }

    .logo-pulse {
      width: 36px; height: 36px;
      border: 2px solid var(--red);
      border-radius: 50%;
      animation: pulse-ring 2s ease-out infinite;
    }
    .logo-pulse::after {
      content: 'â™¥';
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      font-size: 14px; color: var(--red);
    }
    @keyframes pulse-ring {
      0% { transform: scale(1); opacity: 1; box-shadow: 0 0 0 0 var(--red-glow); }
      70% { transform: scale(1.1); opacity: 0.7; box-shadow: 0 0 0 8px transparent; }
      100% { transform: scale(1); opacity: 1; }
    }

    .logo-text {
      font-family: var(--sans);
      font-weight: 800;
      font-size: 1.25rem;
      letter-spacing: -0.02em;
    }
    .logo-text span { color: var(--red); }

    .nav-tabs {
      display: flex; gap: 4px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 4px;
    }

    .nav-tab {
      padding: 8px 24px;
      border-radius: 7px;
      font-family: var(--sans);
      font-size: 0.82rem;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      cursor: pointer;
      border: none;
      color: var(--text2);
      background: transparent;
      transition: all 0.2s;
    }
    .nav-tab.active {
      background: var(--red);
      color: #fff;
      box-shadow: 0 0 20px var(--red-glow);
    }
    .nav-tab:hover:not(.active) { color: var(--text); background: var(--surface2); }

    .nav-status {
      display: flex; align-items: center; gap: 8px;
      font-family: var(--mono);
      font-size: 0.72rem;
      color: var(--text3);
    }
    .status-dot {
      width: 7px; height: 7px; border-radius: 50%;
      background: #2dca73;
      box-shadow: 0 0 6px #2dca73;
      animation: blink 2s ease-in-out infinite;
    }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.4} }

    /* â”€â”€ Hero â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .hero {
      position: relative;
      text-align: center;
      padding: 80px 48px 60px;
      overflow: hidden;
    }

    .hero-bg {
      position: absolute; inset: 0; z-index: 0;
      background:
        radial-gradient(ellipse 60% 50% at 50% 0%, rgba(232,41,74,0.12) 0%, transparent 70%),
        radial-gradient(ellipse 40% 30% at 20% 50%, rgba(201,168,76,0.05) 0%, transparent 60%);
    }

    .hero-eyebrow {
      position: relative; z-index: 1;
      font-family: var(--mono);
      font-size: 0.72rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--red);
      margin-bottom: 20px;
      display: inline-block;
      padding: 6px 16px;
      border: 1px solid var(--red-dim);
      border-radius: 100px;
      background: var(--red-glow);
    }

    .hero h1 {
      position: relative; z-index: 1;
      font-family: var(--serif);
      font-size: clamp(2.8rem, 6vw, 5rem);
      font-weight: 300;
      line-height: 1.1;
      letter-spacing: -0.02em;
      margin-bottom: 20px;
      color: var(--text);
    }
    .hero h1 em {
      font-style: italic;
      color: var(--gold);
    }

    .hero p {
      position: relative; z-index: 1;
      font-size: 1rem;
      color: var(--text2);
      max-width: 560px;
      margin: 0 auto;
      line-height: 1.7;
    }

    /* â”€â”€ Sections â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .section {
      display: none;
      padding: 0 48px 80px;
      max-width: 1200px;
      margin: 0 auto;
      position: relative; z-index: 1;
      animation: fadeUp 0.4s ease both;
    }
    .section.active { display: block; }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* â”€â”€ Section Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .section-header {
      display: flex; align-items: flex-end; justify-content: space-between;
      margin-bottom: 40px;
      padding-bottom: 24px;
      border-bottom: 1px solid var(--border);
    }
    .section-title {
      font-family: var(--serif);
      font-size: 2.2rem;
      font-weight: 300;
      letter-spacing: -0.02em;
    }
    .section-title strong {
      font-weight: 600;
      color: var(--red);
    }
    .section-subtitle {
      font-family: var(--mono);
      font-size: 0.72rem;
      color: var(--text3);
      letter-spacing: 0.1em;
      text-transform: uppercase;
    }

    /* â”€â”€ Upload Zone â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .upload-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }

    .upload-zone {
      border: 2px dashed var(--border2);
      border-radius: var(--radius-lg);
      padding: 48px 32px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      background: var(--surface);
      position: relative;
      overflow: hidden;
    }
    .upload-zone::before {
      content: '';
      position: absolute; inset: 0;
      background: radial-gradient(ellipse at center, var(--red-glow) 0%, transparent 70%);
      opacity: 0;
      transition: opacity 0.3s;
    }
    .upload-zone:hover { border-color: var(--red); }
    .upload-zone:hover::before { opacity: 1; }
    .upload-zone.drag-over {
      border-color: var(--red);
      background: var(--surface2);
    }
    .upload-zone.drag-over::before { opacity: 1; }

    .upload-icon {
      font-size: 2.5rem;
      margin-bottom: 16px;
      display: block;
    }
    .upload-title {
      font-weight: 700;
      font-size: 1rem;
      margin-bottom: 8px;
      color: var(--text);
    }
    .upload-sub {
      font-size: 0.8rem;
      color: var(--text3);
      font-family: var(--mono);
    }

    .divider-or {
      display: flex; align-items: center; justify-content: center;
      gap: 16px;
      margin: 24px 0;
      color: var(--text3);
      font-family: var(--mono);
      font-size: 0.75rem;
      letter-spacing: 0.15em;
    }
    .divider-or::before, .divider-or::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    /* â”€â”€ Textarea â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .textarea-wrap {
      position: relative;
      margin-bottom: 20px;
    }
    .prescription-textarea {
      width: 100%;
      min-height: 180px;
      padding: 20px;
      background: var(--surface);
      border: 1px solid var(--border2);
      border-radius: var(--radius-lg);
      color: var(--text);
      font-family: var(--mono);
      font-size: 0.85rem;
      line-height: 1.7;
      resize: vertical;
      transition: border-color 0.2s;
      outline: none;
    }
    .prescription-textarea:focus {
      border-color: var(--red);
      box-shadow: 0 0 0 3px var(--red-glow);
    }
    .prescription-textarea::placeholder { color: var(--text3); }

    /* â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .btn {
      display: inline-flex; align-items: center; gap: 10px;
      padding: 14px 32px;
      border-radius: 10px;
      font-family: var(--sans);
      font-size: 0.88rem;
      font-weight: 700;
      letter-spacing: 0.04em;
      cursor: pointer;
      border: none;
      transition: all 0.25s;
    }
    .btn-primary {
      background: var(--red);
      color: #fff;
      box-shadow: 0 4px 24px var(--red-glow);
    }
    .btn-primary:hover {
      background: #f03254;
      box-shadow: 0 6px 32px rgba(232,41,74,0.4);
      transform: translateY(-1px);
    }
    .btn-primary:active { transform: translateY(0); }
    .btn-primary:disabled {
      opacity: 0.5; cursor: not-allowed; transform: none;
    }
    .btn-ghost {
      background: transparent;
      color: var(--text2);
      border: 1px solid var(--border2);
    }
    .btn-ghost:hover { border-color: var(--text2); color: var(--text); }

    /* â”€â”€ Disease Search (Section 2) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .search-box {
      position: relative;
      margin-bottom: 32px;
    }
    .search-input {
      width: 100%;
      padding: 20px 20px 20px 56px;
      background: var(--surface);
      border: 1px solid var(--border2);
      border-radius: var(--radius-lg);
      color: var(--text);
      font-family: var(--sans);
      font-size: 1.05rem;
      outline: none;
      transition: all 0.2s;
    }
    .search-input:focus {
      border-color: var(--red);
      box-shadow: 0 0 0 3px var(--red-glow);
    }
    .search-input::placeholder { color: var(--text3); }
    .search-icon {
      position: absolute; left: 20px; top: 50%;
      transform: translateY(-50%);
      font-size: 1.2rem; color: var(--text3);
    }

    .condition-chips {
      display: flex; flex-wrap: wrap; gap: 10px;
      margin-bottom: 32px;
    }
    .chip {
      padding: 8px 18px;
      background: var(--surface);
      border: 1px solid var(--border2);
      border-radius: 100px;
      font-size: 0.78rem;
      font-family: var(--mono);
      color: var(--text2);
      cursor: pointer;
      transition: all 0.2s;
    }
    .chip:hover, .chip.selected {
      background: var(--red-glow);
      border-color: var(--red);
      color: var(--red);
    }
    .chip.emergency {
      border-color: var(--red-dim);
      color: var(--red);
    }
    .chip.emergency:hover {
      background: var(--red-glow);
    }

    /* Patient Info Accordion */
    .accordion {
      margin-bottom: 24px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
    }
    .accordion-header {
      padding: 16px 20px;
      background: var(--surface);
      cursor: pointer;
      display: flex; align-items: center; justify-content: space-between;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text2);
      transition: background 0.2s;
    }
    .accordion-header:hover { background: var(--surface2); color: var(--text); }
    .accordion-body {
      display: none;
      padding: 20px;
      background: var(--bg2);
      border-top: 1px solid var(--border);
    }
    .accordion-body.open { display: block; }
    .accordion-arrow { transition: transform 0.2s; }
    .accordion-arrow.open { transform: rotate(180deg); }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 16px;
    }
    .form-group label {
      display: block;
      font-family: var(--mono);
      font-size: 0.7rem;
      color: var(--text3);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 8px;
    }
    .form-group input, .form-group select {
      width: 100%;
      padding: 10px 14px;
      background: var(--surface);
      border: 1px solid var(--border2);
      border-radius: 8px;
      color: var(--text);
      font-family: var(--mono);
      font-size: 0.82rem;
      outline: none;
      transition: border-color 0.2s;
    }
    .form-group input:focus, .form-group select:focus {
      border-color: var(--gold);
    }
    .form-group select option { background: var(--surface); }

    /* â”€â”€ Loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .loading-overlay {
      display: none;
      position: fixed; inset: 0; z-index: 200;
      background: rgba(4,6,10,0.85);
      backdrop-filter: blur(8px);
      align-items: center; justify-content: center;
      flex-direction: column; gap: 24px;
    }
    .loading-overlay.active { display: flex; }

    .ecg-loader {
      width: 200px; height: 60px;
    }
    .ecg-path {
      stroke-dasharray: 400;
      stroke-dashoffset: 400;
      animation: ecg-draw 1.5s ease-in-out infinite;
    }
    @keyframes ecg-draw {
      0% { stroke-dashoffset: 400; }
      50% { stroke-dashoffset: 0; }
      100% { stroke-dashoffset: -400; }
    }

    .loading-text {
      font-family: var(--mono);
      font-size: 0.82rem;
      color: var(--text2);
      letter-spacing: 0.1em;
    }

    /* â”€â”€ Results â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .result-section {
      margin-top: 48px;
      animation: fadeUp 0.5s ease both;
    }

    .result-header {
      display: flex; align-items: center; gap: 16px;
      margin-bottom: 32px;
    }
    .result-tag {
      font-family: var(--mono);
      font-size: 0.68rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      padding: 5px 12px;
      border-radius: 100px;
      border: 1px solid var(--red-dim);
      color: var(--red);
      background: var(--red-glow);
    }
    .result-tag.gold {
      border-color: rgba(201,168,76,0.4);
      color: var(--gold);
      background: var(--gold-dim);
    }

    .emergency-banner {
      background: linear-gradient(135deg, rgba(232,41,74,0.2), rgba(160,29,51,0.3));
      border: 1px solid var(--red);
      border-radius: var(--radius-lg);
      padding: 20px 24px;
      margin-bottom: 28px;
      display: flex; align-items: flex-start; gap: 16px;
      animation: pulse-bg 2s ease-in-out infinite;
    }
    @keyframes pulse-bg {
      0%,100% { box-shadow: 0 0 0 0 rgba(232,41,74,0.3); }
      50% { box-shadow: 0 0 0 8px rgba(232,41,74,0); }
    }
    .emergency-icon { font-size: 1.8rem; flex-shrink: 0; }
    .emergency-title {
      font-weight: 800;
      font-size: 1rem;
      color: var(--red);
      margin-bottom: 6px;
    }
    .emergency-text { font-size: 0.88rem; color: var(--text2); line-height: 1.6; }

    /* Cards grid */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 20px;
      margin-bottom: 28px;
    }

    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 28px;
      transition: border-color 0.2s, transform 0.2s;
      position: relative;
      overflow: hidden;
    }
    .card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--red), transparent);
      opacity: 0;
      transition: opacity 0.3s;
    }
    .card:hover { border-color: var(--border2); transform: translateY(-2px); }
    .card:hover::before { opacity: 1; }

    .card.gold-accent::before { background: linear-gradient(90deg, var(--gold), transparent); }

    .card-label {
      font-family: var(--mono);
      font-size: 0.65rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--text3);
      margin-bottom: 12px;
      display: flex; align-items: center; gap: 8px;
    }
    .card-label::before {
      content: '';
      width: 16px; height: 1px;
      background: var(--red);
    }
    .card.gold-accent .card-label::before { background: var(--gold); }

    .card-title {
      font-family: var(--serif);
      font-size: 1.4rem;
      font-weight: 300;
      margin-bottom: 12px;
      color: var(--text);
    }
    .card-body {
      font-size: 0.88rem;
      color: var(--text2);
      line-height: 1.75;
    }

    /* Medication Cards */
    .med-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
      gap: 16px;
      margin-bottom: 28px;
    }

    .med-card {
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 24px;
      transition: all 0.25s;
    }
    .med-card:hover { border-color: var(--gold); }

    .med-header {
      display: flex; align-items: flex-start; justify-content: space-between;
      margin-bottom: 16px;
    }
    .med-name {
      font-family: var(--serif);
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text);
    }
    .med-class {
      font-family: var(--mono);
      font-size: 0.65rem;
      color: var(--gold);
      background: var(--gold-dim);
      border: 1px solid rgba(201,168,76,0.25);
      padding: 3px 10px;
      border-radius: 100px;
      margin-top: 4px;
    }
    .med-priority {
      font-family: var(--mono);
      font-size: 0.6rem;
      padding: 4px 10px;
      border-radius: 100px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      flex-shrink: 0;
    }
    .priority-first {
      background: rgba(45,202,115,0.15);
      color: #2dca73;
      border: 1px solid rgba(45,202,115,0.3);
    }
    .priority-second {
      background: rgba(201,168,76,0.15);
      color: var(--gold);
      border: 1px solid rgba(201,168,76,0.3);
    }
    .priority-adjunct {
      background: var(--surface2);
      color: var(--text3);
      border: 1px solid var(--border);
    }

    .med-row {
      display: flex; justify-content: space-between;
      margin-bottom: 10px;
      font-size: 0.82rem;
    }
    .med-key {
      font-family: var(--mono);
      font-size: 0.7rem;
      color: var(--text3);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    .med-val { color: var(--text); font-weight: 500; text-align: right; max-width: 60%; }

    .med-divider {
      height: 1px;
      background: var(--border);
      margin: 14px 0;
    }

    .tag-list {
      display: flex; flex-wrap: wrap; gap: 6px;
    }
    .tag {
      font-family: var(--mono);
      font-size: 0.68rem;
      padding: 3px 10px;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 100px;
      color: var(--text2);
    }

    /* Summary block */
    .summary-block {
      background: linear-gradient(135deg, var(--surface), var(--bg2));
      border: 1px solid var(--border2);
      border-radius: var(--radius-lg);
      padding: 28px 32px;
      margin-bottom: 28px;
      position: relative;
      overflow: hidden;
    }
    .summary-block::before {
      content: '"';
      position: absolute;
      top: -10px; left: 20px;
      font-family: var(--serif);
      font-size: 8rem;
      color: var(--red);
      opacity: 0.08;
      line-height: 1;
    }
    .summary-text {
      font-family: var(--serif);
      font-size: 1.15rem;
      font-weight: 300;
      line-height: 1.8;
      color: var(--text);
      position: relative; z-index: 1;
    }

    /* Lifestyle list */
    .lifestyle-list {
      list-style: none;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 12px;
    }
    .lifestyle-list li {
      display: flex; align-items: flex-start; gap: 12px;
      font-size: 0.88rem;
      color: var(--text2);
      line-height: 1.5;
      padding: 14px 18px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
    }
    .lifestyle-list li::before {
      content: 'â†’';
      color: var(--gold);
      font-family: var(--mono);
      flex-shrink: 0;
      margin-top: 1px;
    }

    /* Disclaimer */
    .disclaimer {
      margin-top: 40px;
      padding: 16px 20px;
      background: rgba(80,96,112,0.1);
      border: 1px solid var(--border);
      border-radius: 10px;
      font-family: var(--mono);
      font-size: 0.72rem;
      color: var(--text3);
      line-height: 1.6;
      display: flex; gap: 12px; align-items: flex-start;
    }
    .disclaimer-icon { flex-shrink: 0; color: var(--gold); }

    /* Interaction warning */
    .interaction-card {
      background: rgba(232,41,74,0.08);
      border: 1px solid var(--red-dim);
      border-radius: 10px;
      padding: 16px 20px;
      margin-bottom: 10px;
      font-size: 0.85rem;
      color: #f5a0ad;
      display: flex; gap: 12px; align-items: flex-start;
    }
    .interaction-card::before { content: 'âš '; flex-shrink: 0; }

    /* Extracted info pills */
    .info-pills {
      display: flex; flex-wrap: wrap; gap: 10px;
      margin-bottom: 24px;
    }
    .info-pill {
      display: flex; align-items: center; gap: 8px;
      padding: 8px 16px;
      background: var(--surface);
      border: 1px solid var(--border2);
      border-radius: 100px;
      font-family: var(--mono);
      font-size: 0.75rem;
      color: var(--text2);
    }
    .info-pill-key { color: var(--text3); margin-right: 2px; }

    /* â”€â”€ File preview â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .file-preview {
      display: flex; align-items: center; gap: 14px;
      padding: 16px 20px;
      background: var(--surface);
      border: 1px solid var(--border2);
      border-radius: 10px;
      margin-bottom: 16px;
    }
    .file-preview-icon { font-size: 1.8rem; }
    .file-preview-name { font-weight: 600; font-size: 0.9rem; }
    .file-preview-size { font-family: var(--mono); font-size: 0.72rem; color: var(--text3); }
    .file-preview-remove {
      margin-left: auto;
      cursor: pointer;
      color: var(--text3);
      font-size: 1.2rem;
      transition: color 0.2s;
    }
    .file-preview-remove:hover { color: var(--red); }

    /* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .toast {
      position: fixed; bottom: 32px; right: 32px; z-index: 300;
      padding: 14px 20px;
      background: var(--surface2);
      border: 1px solid var(--border2);
      border-radius: 12px;
      font-size: 0.85rem;
      color: var(--text);
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      display: flex; align-items: center; gap: 10px;
      transform: translateY(80px);
      transition: transform 0.3s ease;
      max-width: 360px;
    }
    .toast.show { transform: translateY(0); }
    .toast.error { border-color: var(--red-dim); }
    .toast.success { border-color: rgba(45,202,115,0.4); }

    /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 768px) {
      nav { padding: 14px 20px; }
      .hero { padding: 50px 20px 40px; }
      .section { padding: 0 20px 60px; }
      .upload-grid { grid-template-columns: 1fr; }
      .form-row { grid-template-columns: 1fr; }
      .med-grid { grid-template-columns: 1fr; }
      .cards-grid { grid-template-columns: 1fr; }
      .nav-tabs { display: none; }
    }

    /* â”€â”€ Scrollbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg); }
    ::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--text3); }

    /* â”€â”€ No results placeholder â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .placeholder {
      text-align: center;
      padding: 60px 20px;
    }
    .placeholder-icon {
      font-size: 3.5rem;
      margin-bottom: 20px;
      display: block;
      opacity: 0.3;
    }
    .placeholder-text {
      font-family: var(--serif);
      font-size: 1.4rem;
      font-weight: 300;
      color: var(--text3);
      margin-bottom: 10px;
    }
    .placeholder-sub {
      font-family: var(--mono);
      font-size: 0.75rem;
      color: var(--text3);
      opacity: 0.6;
    }

    /* â”€â”€ Section divider label â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .section-divider {
      display: flex; align-items: center; gap: 16px;
      margin: 36px 0 24px;
    }
    .section-divider-label {
      font-family: var(--mono);
      font-size: 0.68rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--text3);
      white-space: nowrap;
    }
    .section-divider-line {
      flex: 1;
      height: 1px;
      background: var(--border);
    }
  </style>
</head>
<body>

<div class="ecg-header"></div>

<!-- NAV -->
<nav>
  <div class="nav-logo">
    <div class="logo-icon">
      <div class="logo-pulse"></div>
    </div>
    <div class="logo-text">Cardio<span>AI</span></div>
  </div>

  <div class="nav-tabs">
    <button class="nav-tab active" onclick="switchTab('prescription')">Prescription Analysis</button>
    <button class="nav-tab" onclick="switchTab('recommend')">Medicine Recommender</button>
  </div>

  <div class="nav-status">
    <div class="status-dot"></div>
    <span>GROQ Â· llama-3.3-70b</span>
  </div>
</nav>

<!-- HERO -->
<div class="hero">
  <div class="hero-bg"></div>
  <div class="hero-eyebrow">AI-Powered Cardiac Intelligence</div>
  <h1>Your heart deserves<br><em>precise</em> answers</h1>
  <p>Upload a prescription or describe a condition. CardioAI analyzes, explains, and recommends.</p>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- SECTION 1 â€” PRESCRIPTION READER                                 -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section active" id="section-prescription">
  <div class="section-header">
    <div>
      <div class="section-title">Prescription <strong>Reader</strong></div>
      <div class="section-subtitle">Upload image Â· PDF Â· or type directly</div>
    </div>
  </div>

  <!-- Upload -->
  <div class="upload-grid">
    <div class="upload-zone" id="drop-zone" onclick="document.getElementById('file-input').click()">
      <span class="upload-icon">ğŸ“„</span>
      <div class="upload-title">Drop prescription here</div>
      <div class="upload-sub">JPG Â· PNG Â· PDF Â· up to 16MB</div>
      <input type="file" id="file-input" accept=".jpg,.jpeg,.png,.pdf,.bmp,.tiff,.webp" style="display:none" onchange="handleFileSelect(this)" />
    </div>
    <div style="display:flex;flex-direction:column;justify-content:center;gap:16px;">
      <div style="font-family:var(--mono);font-size:0.72rem;color:var(--text3);letter-spacing:0.1em;text-transform:uppercase">Supported formats</div>
      <div style="display:flex;flex-wrap:wrap;gap:8px;">
        <span class="chip">JPEG / PNG</span>
        <span class="chip">PDF</span>
        <span class="chip">Handwritten</span>
        <span class="chip">Printed Rx</span>
        <span class="chip">Clinical Notes</span>
      </div>
      <div style="font-size:0.82rem;color:var(--text2);line-height:1.6">
        Our OCR engine preprocesses and denoises images before sending to the AI for maximum accuracy.
      </div>
    </div>
  </div>

  <!-- File preview -->
  <div id="file-preview" style="display:none"></div>

  <div class="divider-or">OR TYPE YOUR PRESCRIPTION</div>

  <!-- Text input -->
  <div class="textarea-wrap">
    <textarea class="prescription-textarea" id="prescription-text" placeholder="Paste prescription text here...
e.g. Patient: 58M. Diagnosis: Hypertension Stage 2. BP: 160/100 mmHg.
Rx: Tab. Amlodipine 5mg OD. Tab. Lisinopril 10mg OD. Tab. Aspirin 75mg OD after food.
Follow up after 4 weeks."></textarea>
  </div>

  <div style="display:flex;gap:12px;align-items:center">
    <button class="btn btn-primary" id="analyze-btn" onclick="analyzePrescription()">
      <span>ğŸ”¬</span> Analyze Prescription
    </button>
    <button class="btn btn-ghost" onclick="clearPrescription()">Clear</button>
    <div id="rx-char-count" style="font-family:var(--mono);font-size:0.72rem;color:var(--text3);margin-left:auto"></div>
  </div>

  <!-- Results -->
  <div id="prescription-result"></div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- SECTION 2 â€” DISEASE RECOMMENDER                                 -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section" id="section-recommend">
  <div class="section-header">
    <div>
      <div class="section-title">Disease <strong>Recommender</strong></div>
      <div class="section-subtitle">Enter condition Â· Get evidence-based recommendations</div>
    </div>
  </div>

  <!-- Search -->
  <div class="search-box">
    <span class="search-icon">ğŸ”</span>
    <input type="text" class="search-input" id="disease-input"
      placeholder="Type a condition: hypertension, atrial fibrillation, heart failure..."
      onkeydown="if(event.key==='Enter') recommendDisease()" />
  </div>

  <!-- Quick chips -->
  <div class="condition-chips" id="condition-chips"></div>

  <!-- Patient info accordion -->
  <div class="accordion">
    <div class="accordion-header" onclick="toggleAccordion()">
      <span>Optional: Add Patient Context for personalized recommendations</span>
      <span class="accordion-arrow" id="accordion-arrow">â–¾</span>
    </div>
    <div class="accordion-body" id="accordion-body">
      <div class="form-row">
        <div class="form-group">
          <label>Age (years)</label>
          <input type="number" id="pt-age" placeholder="e.g. 65" min="1" max="120" />
        </div>
        <div class="form-group">
          <label>Gender</label>
          <select id="pt-gender">
            <option value="">Select</option>
            <option>Male</option>
            <option>Female</option>
            <option>Other</option>
          </select>
        </div>
        <div class="form-group">
          <label>Comorbidities (comma-separated)</label>
          <input type="text" id="pt-comorbid" placeholder="diabetes, CKD, asthma..." />
        </div>
      </div>
    </div>
  </div>

  <div style="display:flex;gap:12px;margin-bottom:40px">
    <button class="btn btn-primary" onclick="recommendDisease()">
      <span>ğŸ’Š</span> Get Recommendations
    </button>
    <button class="btn btn-ghost" onclick="clearRecommend()">Clear</button>
  </div>

  <!-- Results -->
  <div id="recommend-result"></div>
</div>


<!-- LOADING -->
<div class="loading-overlay" id="loading">
  <svg class="ecg-loader" viewBox="0 0 200 60" fill="none">
    <polyline class="ecg-path"
      points="0,30 20,30 30,10 40,50 50,30 70,30 80,20 90,40 100,30 120,30 130,5 140,55 150,30 200,30"
      stroke="#e8294a" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
    />
  </svg>
  <div class="loading-text" id="loading-text">Analyzing with Groq AI...</div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
  // â”€â”€ Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const API_BASE = 'http://localhost:5000/api';
  let currentFile = null;

  // â”€â”€ Tab switching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function switchTab(tab) {
    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    event.target.classList.add('active');
    document.getElementById('section-' + tab).classList.add('active');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  // â”€â”€ Mobile tab switch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Allow clicking section title for mobile
  function switchTabById(tab) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById('section-' + tab).classList.add('active');
  }

  // â”€â”€ Loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function showLoading(text = 'Analyzing with Groq AI...') {
    document.getElementById('loading-text').textContent = text;
    document.getElementById('loading').classList.add('active');
  }
  function hideLoading() {
    document.getElementById('loading').classList.remove('active');
  }

  // â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let toastTimer;
  function showToast(msg, type = 'info') {
    const t = document.getElementById('toast');
    t.className = 'toast show ' + type;
    const icon = type === 'error' ? 'âš ï¸' : type === 'success' ? 'âœ…' : 'â„¹ï¸';
    t.innerHTML = `<span>${icon}</span> ${msg}`;
    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => t.classList.remove('show'), 4000);
  }

  // â”€â”€ File handling â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const dropZone = document.getElementById('drop-zone');
  dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('drag-over'); });
  dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
  dropZone.addEventListener('drop', e => {
    e.preventDefault();
    dropZone.classList.remove('drag-over');
    const file = e.dataTransfer.files[0];
    if (file) setFile(file);
  });

  function handleFileSelect(input) {
    if (input.files[0]) setFile(input.files[0]);
  }

  function setFile(file) {
    const allowed = ['image/jpeg','image/png','image/bmp','image/tiff','image/webp','application/pdf'];
    if (!allowed.includes(file.type)) {
      showToast('Unsupported file type. Use JPG, PNG, or PDF.', 'error');
      return;
    }
    currentFile = file;
    const size = (file.size / 1024 / 1024).toFixed(2);
    const ext = file.name.split('.').pop().toUpperCase();
    const icon = ext === 'PDF' ? 'ğŸ“‹' : 'ğŸ–¼ï¸';
    document.getElementById('file-preview').style.display = 'flex';
    document.getElementById('file-preview').innerHTML = `
      <div class="file-preview">
        <span class="file-preview-icon">${icon}</span>
        <div>
          <div class="file-preview-name">${file.name}</div>
          <div class="file-preview-size">${ext} Â· ${size} MB</div>
        </div>
        <span class="file-preview-remove" onclick="removeFile()">âœ•</span>
      </div>`;
    document.getElementById('prescription-text').value = '';
    showToast('File ready for analysis', 'success');
  }

  function removeFile() {
    currentFile = null;
    document.getElementById('file-preview').style.display = 'none';
    document.getElementById('file-input').value = '';
  }

  // Char counter
  document.getElementById('prescription-text').addEventListener('input', function() {
    const len = this.value.length;
    document.getElementById('rx-char-count').textContent = len > 0 ? `${len} chars` : '';
  });

  // â”€â”€ Analyze Prescription â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function analyzePrescription() {
    const text = document.getElementById('prescription-text').value.trim();
    if (!currentFile && !text) {
      showToast('Please upload a file or type prescription text', 'error');
      return;
    }

    showLoading('Reading prescription with OCR...');
    document.getElementById('analyze-btn').disabled = true;

    try {
      let response;
      if (currentFile) {
        showLoading('Processing image with AI...');
        const form = new FormData();
        form.append('file', currentFile);
        response = await fetch(`${API_BASE}/read-prescription`, { method: 'POST', body: form });
      } else {
        showLoading('Analyzing prescription text...');
        response = await fetch(`${API_BASE}/read-prescription`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text }),
        });
      }

      const data = await response.json();
      if (!response.ok || !data.success) throw new Error(data.error || 'Analysis failed');
      renderPrescriptionResult(data);
      showToast('Analysis complete!', 'success');
    } catch (e) {
      showToast(e.message, 'error');
      document.getElementById('prescription-result').innerHTML = renderError(e.message);
    } finally {
      hideLoading();
      document.getElementById('analyze-btn').disabled = false;
    }
  }

  function clearPrescription() {
    document.getElementById('prescription-text').value = '';
    document.getElementById('prescription-result').innerHTML = '';
    document.getElementById('rx-char-count').textContent = '';
    removeFile();
  }

  // â”€â”€ Render Prescription Result â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderPrescriptionResult(data) {
    const a = data.analysis;
    const p = data.parsed;
    let html = `<div class="result-section">`;

    // Emergency
    if (a.emergency) {
      html += `
        <div class="emergency-banner">
          <span class="emergency-icon">ğŸš¨</span>
          <div>
            <div class="emergency-title">EMERGENCY CONDITION DETECTED</div>
            <div class="emergency-text">${a.emergency_message || 'This condition requires immediate medical attention. Call 911 or go to the nearest emergency room immediately.'}</div>
          </div>
        </div>`;
    }

    // Header tag
    html += `<div class="result-header"><span class="result-tag">AI Analysis Complete</span></div>`;

    // Extracted info pills
    const pi = p.patient_info || {};
    if (Object.keys(pi).length > 0) {
      html += `<div class="info-pills">`;
      for (const [k,v] of Object.entries(pi)) {
        html += `<div class="info-pill"><span class="info-pill-key">${k.replace(/_/g,' ')}:</span> ${v}</div>`;
      }
      html += `</div>`;
    }

    // Summary
    if (a.summary) {
      html += `
        <div class="summary-block">
          <div class="summary-text">${a.summary}</div>
        </div>`;
    }

    // Conditions
    const conds = a.condition_details || [];
    if (conds.length > 0) {
      html += `
        <div class="section-divider">
          <span class="section-divider-label">Conditions Identified</span>
          <div class="section-divider-line"></div>
        </div>
        <div class="cards-grid">`;
      for (const c of conds) {
        const sev = c.severity || '';
        html += `
          <div class="card">
            <div class="card-label">${sev ? sev.toUpperCase() + ' Â· ' : ''}Cardiac Condition</div>
            <div class="card-title">${c.name || ''}</div>
            <div class="card-body">${c.explanation || ''}</div>
            ${c.classification ? `<div style="margin-top:12px;font-family:var(--mono);font-size:0.72rem;color:var(--text3)">${c.classification}</div>` : ''}
          </div>`;
      }
      html += `</div>`;
    }

    // Drug interactions
    const interactions = a.drug_interactions || [];
    if (interactions.length > 0) {
      html += `
        <div class="section-divider">
          <span class="section-divider-label">âš  Drug Interactions</span>
          <div class="section-divider-line"></div>
        </div>`;
      for (const i of interactions) {
        html += `<div class="interaction-card">${i}</div>`;
      }
    }

    // Medications
    const meds = a.medication_review || [];
    if (meds.length > 0) {
      html += `
        <div class="section-divider">
          <span class="section-divider-label">Medication Review</span>
          <div class="section-divider-line"></div>
        </div>
        <div class="med-grid">`;
      for (const m of meds) {
        html += renderMedCard(m);
      }
      html += `</div>`;
    }

    // Lifestyle
    const ls = a.lifestyle_advice || [];
    if (ls.length > 0) {
      html += `
        <div class="section-divider">
          <span class="section-divider-label">Lifestyle Advice</span>
          <div class="section-divider-line"></div>
        </div>
        <ul class="lifestyle-list">`;
      for (const item of ls) {
        html += `<li>${item}</li>`;
      }
      html += `</ul>`;
    }

    // Follow-up
    if (a.follow_up) {
      html += `
        <div class="card gold-accent" style="margin-top:24px">
          <div class="card-label">Follow-up Recommendation</div>
          <div class="card-body">${a.follow_up}</div>
        </div>`;
    }

    // Disclaimer
    html += renderDisclaimer(a.disclaimer);
    html += `</div>`;
    document.getElementById('prescription-result').innerHTML = html;
    document.getElementById('prescription-result').scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  // â”€â”€ Recommend by Disease â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function recommendDisease(condition = null) {
    const cond = condition || document.getElementById('disease-input').value.trim();
    if (!cond) {
      showToast('Please enter a cardiac condition', 'error');
      return;
    }

    const age = document.getElementById('pt-age').value;
    const gender = document.getElementById('pt-gender').value;
    const comorbid = document.getElementById('pt-comorbid').value;

    const patientInfo = {};
    if (age) patientInfo.age = parseInt(age);
    if (gender) patientInfo.gender = gender;
    if (comorbid) patientInfo.comorbidities = comorbid.split(',').map(s => s.trim()).filter(Boolean);

    showLoading(`Generating recommendations for "${cond}"...`);

    try {
      const response = await fetch(`${API_BASE}/recommend`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ condition: cond, patient_info: patientInfo }),
      });
      const data = await response.json();
      if (!response.ok || !data.success) throw new Error(data.error || 'Recommendation failed');
      renderRecommendResult(data.recommendation, cond);
      showToast('Recommendations ready!', 'success');
    } catch (e) {
      showToast(e.message, 'error');
      document.getElementById('recommend-result').innerHTML = renderError(e.message);
    } finally {
      hideLoading();
    }
  }

  function clearRecommend() {
    document.getElementById('disease-input').value = '';
    document.getElementById('recommend-result').innerHTML = '';
    document.querySelectorAll('.chip').forEach(c => c.classList.remove('selected'));
  }

  // â”€â”€ Render Recommend Result â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderRecommendResult(r, inputCondition) {
    let html = `<div class="result-section">`;

    // Emergency
    if (r.emergency) {
      html += `
        <div class="emergency-banner">
          <span class="emergency-icon">ğŸš¨</span>
          <div>
            <div class="emergency-title">EMERGENCY â€” Seek Immediate Medical Care</div>
            <div class="emergency-text">${r.emergency_message || ''}</div>
          </div>
        </div>`;
    }

    html += `<div class="result-header"><span class="result-tag gold">Recommendations</span></div>`;

    // Condition overview
    const cond = r.condition || {};
    if (cond.name || cond.explanation) {
      html += `
        <div class="summary-block">
          <div class="card-label">${cond.name || inputCondition}</div>
          <div class="summary-text">${cond.explanation || ''}</div>
        </div>`;
    }

    // Causes & Symptoms
    if ((cond.causes?.length || cond.symptoms?.length)) {
      html += `<div class="cards-grid">`;
      if (cond.causes?.length) {
        html += `
          <div class="card">
            <div class="card-label">Common Causes</div>
            <ul class="lifestyle-list" style="grid-template-columns:1fr">
              ${cond.causes.map(c => `<li>${c}</li>`).join('')}
            </ul>
          </div>`;
      }
      if (cond.symptoms?.length) {
        html += `
          <div class="card">
            <div class="card-label">Symptoms</div>
            <ul class="lifestyle-list" style="grid-template-columns:1fr">
              ${cond.symptoms.map(s => `<li>${s}</li>`).join('')}
            </ul>
          </div>`;
      }
      html += `</div>`;
    }

    // Medications
    const meds = r.recommended_medications || [];
    if (meds.length > 0) {
      html += `
        <div class="section-divider">
          <span class="section-divider-label">Recommended Medications</span>
          <div class="section-divider-line"></div>
        </div>
        <div class="med-grid">`;
      for (const m of meds) {
        html += renderMedCard(m);
      }
      html += `</div>`;
    }

    // Treatment goals
    const goals = r.treatment_goals || [];
    if (goals.length > 0) {
      html += `
        <div class="section-divider">
          <span class="section-divider-label">Treatment Goals</span>
          <div class="section-divider-line"></div>
        </div>
        <div class="cards-grid" style="grid-template-columns:1fr">
          <div class="card gold-accent">
            <ul class="lifestyle-list">
              ${goals.map(g => `<li>${g}</li>`).join('')}
            </ul>
          </div>
        </div>`;
    }

    // Lifestyle
    const ls = r.lifestyle_advice || [];
    if (ls.length > 0) {
      html += `
        <div class="section-divider">
          <span class="section-divider-label">Lifestyle Modifications</span>
          <div class="section-divider-line"></div>
        </div>
        <ul class="lifestyle-list">
          ${ls.map(i => `<li>${i}</li>`).join('')}
        </ul>`;
    }

    // Emergency signs
    const emergency = r.when_to_seek_emergency || [];
    if (emergency.length > 0) {
      html += `
        <div class="section-divider">
          <span class="section-divider-label">âš  Seek Emergency Care If</span>
          <div class="section-divider-line"></div>
        </div>`;
      for (const e of emergency) {
        html += `<div class="interaction-card">${e}</div>`;
      }
    }

    // Patient context warnings
    const ctx = r.patient_context;
    if (ctx?.warnings?.length) {
      html += `
        <div class="section-divider">
          <span class="section-divider-label">Personalized Warnings</span>
          <div class="section-divider-line"></div>
        </div>`;
      for (const w of ctx.warnings) {
        html += `<div class="interaction-card">${w}</div>`;
      }
    }

    html += renderDisclaimer(r.disclaimer);
    html += `</div>`;
    document.getElementById('recommend-result').innerHTML = html;
    document.getElementById('recommend-result').scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  // â”€â”€ Shared render helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderMedCard(m) {
    const p = (m.priority || 'adjunct').toLowerCase();
    const pClass = p.includes('first') ? 'priority-first' : p.includes('second') ? 'priority-second' : 'priority-adjunct';
    const pLabel = p.includes('first') ? 'First-Line' : p.includes('second') ? 'Second-Line' : 'Adjunct';
    const sideEffects = Array.isArray(m.side_effects) ? m.side_effects : (m.side_effects ? [m.side_effects] : []);

    return `
      <div class="med-card">
        <div class="med-header">
          <div>
            <div class="med-name">${m.name || m.drug_name || ''}</div>
            <div class="med-class">${m.drug_class || m.class || ''}</div>
          </div>
          <span class="med-priority ${pClass}">${pLabel}</span>
        </div>
        ${m.purpose ? `<div style="font-size:0.82rem;color:var(--text2);margin-bottom:14px;line-height:1.5">${m.purpose}</div>` : ''}
        <div class="med-row">
          <span class="med-key">Dosage</span>
          <span class="med-val">${m.dosage || 'â€”'}</span>
        </div>
        ${m.frequency ? `<div class="med-row"><span class="med-key">Frequency</span><span class="med-val">${m.frequency}</span></div>` : ''}
        <div class="med-row">
          <span class="med-key">Mechanism</span>
          <span class="med-val">${m.mechanism || 'â€”'}</span>
        </div>
        ${m.monitoring ? `<div class="med-row"><span class="med-key">Monitoring</span><span class="med-val">${m.monitoring}</span></div>` : ''}
        ${sideEffects.length > 0 ? `
          <div class="med-divider"></div>
          <div class="med-key" style="margin-bottom:8px">Side Effects</div>
          <div class="tag-list">${sideEffects.map(s => `<span class="tag">${s}</span>`).join('')}</div>
        ` : ''}
      </div>`;
  }

  function renderDisclaimer(text) {
    const msg = text || 'This information is for educational purposes only. Always consult a licensed cardiologist or physician before making any medical decisions. Never self-medicate.';
    return `
      <div class="disclaimer">
        <span class="disclaimer-icon">âš–ï¸</span>
        <span>${msg}</span>
      </div>`;
  }

  function renderError(msg) {
    return `
      <div class="result-section">
        <div class="emergency-banner">
          <span class="emergency-icon">âŒ</span>
          <div>
            <div class="emergency-title">Error</div>
            <div class="emergency-text">${msg}<br><br>Make sure your Flask backend is running at <code style="color:var(--gold)">${API_BASE}</code> and your GROQ_API_KEY is set.</div>
          </div>
        </div>
      </div>`;
  }

  // â”€â”€ Accordion â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function toggleAccordion() {
    const body = document.getElementById('accordion-body');
    const arrow = document.getElementById('accordion-arrow');
    body.classList.toggle('open');
    arrow.classList.toggle('open');
  }

  // â”€â”€ Load conditions chips â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadConditions() {
    try {
      const res = await fetch(`${API_BASE}/conditions`);
      const data = await res.json();
      if (!data.success) return;
      const container = document.getElementById('condition-chips');
      for (const c of data.conditions) {
        const chip = document.createElement('div');
        chip.className = 'chip' + (c.emergency ? ' emergency' : '');
        chip.textContent = (c.emergency ? 'ğŸš¨ ' : '') + c.name;
        chip.onclick = () => {
          document.querySelectorAll('.chip').forEach(ch => ch.classList.remove('selected'));
          chip.classList.add('selected');
          document.getElementById('disease-input').value = c.id;
          recommendDisease(c.id);
        };
        container.appendChild(chip);
      }
    } catch (e) {
      // API not running yet â€” show static chips
      const fallback = [
        'Hypertension','Heart Failure','Atrial Fibrillation',
        'Coronary Artery Disease','Hyperlipidemia','Arrhythmia',
        'Cardiomyopathy','Aortic Stenosis'
      ];
      const container = document.getElementById('condition-chips');
      for (const name of fallback) {
        const chip = document.createElement('div');
        chip.className = 'chip';
        chip.textContent = name;
        chip.onclick = () => {
          document.querySelectorAll('.chip').forEach(ch => ch.classList.remove('selected'));
          chip.classList.add('selected');
          document.getElementById('disease-input').value = name;
          recommendDisease(name);
        };
        container.appendChild(chip);
      }
    }
  }

  // Also make nav tabs accessible via keyboard
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') {
      document.getElementById('loading').classList.remove('active');
    }
  });

  // Init
  loadConditions();
</script>
</body>
</html>
